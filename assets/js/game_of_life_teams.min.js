document.addEventListener("DOMContentLoaded",function(){var e=d3.select("#gameoflife").insert("svg"),t=document.getElementById("gameStatus"),a=document.getElementById("clearBoard"),l=document.getElementById("gameSpeed"),n=document.getElementById("gameTeam"),r=document.getElementById("teamScore"),i=!1,o=function(e,t,a={}){let l=e,n=[],r=a.currentTeam?a.currentTeam:"red",i={red:"#e00467",blue:"blue"},o=["red","blue"],c=i[r],d=a.gridSizeWidth?a.gridSizeWidth:e[0].length,s=a.gridSizeHeight?a.gridSizeHeight:e[0].length,m=a.boxSize?a.boxSize:10,u=0,g=a.epochTime?a.epochTime:300,h=a.transition?a.transition:50,v=a.deathColor?a.deathColor:"white",p=(a.aliveColor&&a.aliveColor,{red:0,blue:0}),b=a.teamScoreSpan?a.teamScoreSpan:null,f=null,S=a.impactArea?a.impactArea:1;function _(e,t,a,l,n){let r={red:0,blue:0},o={team:a.new_element,color:a.color,is_alive:a.is_alive},c=0;var[d,s,m,u]=[0,0,0,0];d=e-n>=0?e-n:0,s=t-n>=0?t-n:0,m=e+n>=l[t].length?l[t].length-1:e+n,u=t+n>=l.length?l.length-1:t+n;for(let e=s;e<=u;e++)for(let t=d;t<=m;t++)1===l[e][t].is_alive&&(r[l[e][t].team]=r[l[e][t].team]+1,c++);var g=void 0,h=0,v="red";if("none"!=a.team)h=r[a.team],v=a.team;else{for(let e=0;e<Object.keys(r).length;e++)r[v]<r[Object.keys(r)[e]]&&(v=Object.keys(r)[e]);h=r[v]}return neighbourhood_sum=c,g=1===a.is_alive?(h-=1)>3||h<2?0:1:3===h?1:a.is_alive,o.is_alive=g,1===g?(o.team=v,o.color=i[v]):(o.team="none",o.color="white"),o}function T(e=null){t.selectAll("rect.cell").data(n).enter().append("rect").attr("class","cell").attr("x",function(e,t){return t%d*m}).attr("y",function(e,t){return Math.floor(t/d)*m}).attr("width",m).attr("height",m).on("click",function(e,t){n[t].is_alive^=1,n[t].color=c,n[t].team=r,function(){for(let e=0,t=0,a=0;e<n.length;e++,t++)t<d?l[a][t]=n[e]:(t=0,l[++a][t]=n[e])}(),T(l)}).transition().duration(h).style("fill",function(e,t){return n[t]?n[t].color:v}),t.selectAll("rect.cell").transition().duration(h).style("fill",function(e,t){return n[t].is_alive?n[t].color:v})}function y(){let e=function(e){var t=[];for(let a=0;a<e;a++)t[a]=[{team:"none",color:"none",is_alive:0}];return t}(l.length);p.red=0,p.blue=0;for(let t=0;t<l.length;t++)for(let a=0;a<l[t].length;a++){let n=_(a,t,l[t][a],l,S);e[t][a]={is_alive:n.is_alive,team:n.team,color:n.color},"red"===n.team&&(p.red+=1),"blue"===n.team&&(p.blue+=1)}b&&(b.innerHTML='<span class="redTeam">Red: '+p.red+'</span> <span class="blueTeam">Blue: '+p.blue+"</span>"),n=(l=e).reduce((e,t)=>e.concat(t)),u+=1,T()}return t.attr("height",m*s).attr("width",m*d).append("g"),T(e),{nextFrame:y,start:()=>{f=setInterval(y,g)},stop:()=>{clearInterval(f)},changeSpeed:e=>{g=e,console.log("Speed Changed (Epoch Time): "+e+"ms")},setImpactArea:e=>{S=e,console.log("Impact Area: "+S)},clear:()=>{for(let e=0;e<s;e++)for(let t=0;t<d;t++)l[e][t]={team:"none",color:"white",is_alive:0};n=l.reduce((e,t)=>e.concat(t)),b&&(b.innerHTML='<span class="redTeam">Red: 0</span> <span class="blueTeam">Blue: 0</span>'),T()},changeTeam:e=>{c=i[e],r=e},availableTeams:()=>o,init:()=>{for(let e=0;e<s;e++){l[e]=[];for(let t=0;t<d;t++)l[e][t]={team:"none",color:"white",is_alive:0}}l[5][5]={team:"red",color:"#e00467",is_alive:1},l[6][4]={team:"red",color:"#e00467",is_alive:1},l[6][5]={team:"red",color:"#e00467",is_alive:1},l[6][6]={team:"red",color:"#e00467",is_alive:1},l[5][10]={team:"blue",color:"blue",is_alive:1},l[6][9]={team:"blue",color:"blue",is_alive:1},l[6][10]={team:"blue",color:"blue",is_alive:1},l[6][11]={team:"blue",color:"blue",is_alive:1},n=l.reduce((e,t)=>e.concat(t)),T()}}}([],e,{gridSizeWidth:62,gridSizeHeight:27,teamScoreSpan:r});o.init(),t.addEventListener("click",e=>{(i=!i)?(o.start(),e.target.innerHTML="Stop",l.disabled=!0):(o.stop(),e.target.innerHTML="Start",l.disabled=!1)}),a.addEventListener("click",e=>{o.clear(),i&&(i=!i,o.stop(),t.innerHTML="Start",l.disabled=!1)}),l.addEventListener("change",e=>{let t=e.target.value;isNaN(t)||(t=parseInt(t),o.changeSpeed(t))}),n.addEventListener("change",e=>{let t=e.target.value;o.availableTeams().indexOf(t)>-1&&o.changeTeam(t)})});